pipeline
{agent any
stages
{
stage('scm checkout')
{
   steps { git branch: 'master', url: 'https://github.com/Prathamesh2809/mavenproject.git' }}


stage('compile the job')    
{
   steps { withMaven(globalMavenSettingsConfig: '', jdk: 'JDK_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true) {
   sh 'mvn compile'    
} }} 

stage('execute a unit test framework')    
{
   steps { withMaven(globalMavenSettingsConfig: '', jdk: 'JDK_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true) {
   sh 'mvn test'    
} }}

stage('Build the code')    
{
   steps { withMaven(globalMavenSettingsConfig: '', jdk: 'JDK_HOME', maven: 'MAVEN_HOME', mavenSettingsConfig: '', traceability: true) {
   sh 'mvn clean -B -DskipTests package'    
} }}

 stage('build docker image')
 {steps { sh 'docker build -t pkw0301/devops:tomcat .' }}

 stage('push docker image to dockerhub')
 {step{ 
    withDockerRegistry(credentialsId: 'dockerhub-cred', url: 'https://index.docker.io/v1/') {
    sh 'docker push prathamesh2809/devops:tomcat'
}
  }}

}
}

